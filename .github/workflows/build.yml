name: 生成EXE文件
on: workflow_dispatch  # 允许手动按钮触发

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: recursive # 确保下载所有子模块

    # 1. 配置 vcpkg 环境
    - name: Setup vcpkg
      run: |
        git clone https://github.com/Microsoft/vcpkg.git
        .\vcpkg\bootstrap-vcpkg.bat

    # 2. 安装项目需要的依赖 (根据官方README)
    - name: Install Dependencies
      run: .\vcpkg\vcpkg install glfw3 boost-system:x64-windows

    # 3. 编译项目
    - name: Build
      run: |
        mkdir build
        cd build
        cmake .. -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake -DVCPKG_TARGET_TRIPLET=x64-windows
        cmake --build . --config Release

    # 4. 把生成的文件打包上传
    - name: Upload EXE
      uses: actions/upload-artifact@v4
      with:
        name: ConnectTool-Windows
        path: build/Release/*.exe
