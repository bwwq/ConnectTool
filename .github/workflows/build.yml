name: 生成EXE文件
on: workflow_dispatch

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: recursive

    # 1. 配置 vcpkg 环境
    - name: Setup vcpkg
      run: |
        git clone https://github.com/Microsoft/vcpkg.git
        .\vcpkg\bootstrap-vcpkg.bat

    # 2. 安装项目需要的依赖
    - name: Install Dependencies
      run: .\vcpkg\vcpkg install glfw3 boost-system:x64-windows

    # 3. 编译项目 (这里修复了命令顺序)
    - name: Build
      shell: cmd
      run: |
        mkdir build
        cd build
        cmake -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake -DVCPKG_TARGET_TRIPLET=x64-windows ..
        cmake --build . --config Release

    # 4. 上传成品
    - name: Upload EXE
      uses: actions/upload-artifact@v4
      with:
        name: ConnectTool-Windows
        path: build/Release/*.exe
